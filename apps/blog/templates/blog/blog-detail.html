{% extends 'base_seo.html' %}
{% load static %}
{% load blog_tags %}
{% block content %}
<article class="flex-1 md:ml-62">
  <main class="px-3 py-4 sm:px-4 md:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
      <header class="mb-6 md:mb-8">
        <h1 class="text-2xl lg:text-3xl font-medium mb-2 md:mb-3 text-fuchsia-400">{{ blog.title }}</h1>
        <div class="flex items-center gap-2 md:gap-3 mb-4">
          {% if blog.author_image %}
          <img src="https://wsrv.nl/?url={{ blog.author_image }}&w=50&h=50"
               alt="{{ blog.author }}"
               class="w-8 h-8 sm:w-9 sm:h-9 rounded-full ring-2 ring-fuchsia-500/60" />
          {% endif %}
          <div>
            <span class="font-medium text-fuchsia-300">{{ blog.author }}</span>
            <div class="text-xs sm:text-sm text-zinc-400">
              <time datetime="{{ blog.created_at|date:'c' }}">
                {{ blog.created_at|date:"g:i A T, D F j, Y" }}
              </time>
              {% if blog.updated_at|date:'YmdHis' > blog.created_at|date:'YmdHis' %}
              <span class="mx-1">•</span>
              <span class="italic text-sky-400">Edited {{ blog.updated_at|date:"g:i A T, D F j, Y" }}</span>
              {% endif %}
            </div>
          </div>
        </div>
      </header>

      <div class="mb-6 md:mb-8">
        <div class="rounded-xl overflow-hidden shadow-lg border border-fuchsia-600/40 relative">
          <img src="https://wsrv.nl/?url={{ blog.image_url }}" alt="{{ blog.title }}"
               class="w-full object-cover aspect-video saturate-125" loading="lazy" />
        </div>
      </div>

      <!-- Konten Blog -->
      <div class="prose prose-invert max-w-none mb-10" id="blog-content">
        {% for content_item in blog.content %}
          {% if content_item.type == 'p' %}
            <p class="{{ content_item.class }}">{{ content_item.text|safe }}</p>

          {% elif content_item.type == 'h2' %}
            <h2 class="{{ content_item.class }} text-fuchsia-400 font-semibold">{{ content_item.text|safe }}</h2>

          {% elif content_item.type == 'ul' %}
            <ul class="{{ content_item.class }}">
              {% for item in content_item.items %}
                <li class="marker:text-fuchsia-400">{{ item|safe }}</li>
              {% endfor %}
            </ul>
          {% elif content_item.type == 'code' or content_item.type == 'pre' %}
          <div class="code-wrapper">
            <div class="code-header">
              <div class="dots">
                <span class="dot red"></span>
                <span class="dot yellow"></span>
                <span class="dot green"></span>
              </div>
              <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            </div>
            <pre class="code-block"><code class="language-{{ content_item.lang|default:'python' }}">{{ content_item.text|escape }}</code></pre>
          </div>

          {% else %}
            <p class="mb-3">{{ content_item.text|safe }}</p>
          {% endif %}
        {% endfor %}
      </div>

      <footer>
        <h2 class="text-lg sm:text-xl font-semibold mb-2 text-fuchsia-400">Tags</h2>
        <div class="flex flex-wrap gap-2">
          {% for tag in blog.tags %}
          <span class="text-xs font-medium rounded-full bg-fuchsia-900/30 text-fuchsia-300 border border-fuchsia-700/60 px-2 py-0.5 sm:px-2.5 sm:py-1 font-mono shadow-[0_0_10px_#f0f_0.2]">
            #{{ tag|slugify }}
          </span>
          {% endfor %}
        </div>
      </footer>
    </div>
  </main>
</article>
{% endblock %}

{% block scripts %}
<!-- Highlight.js -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<!-- Marked.js -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // Parse markdown text in paragraphs
  document.querySelectorAll('#blog-content p').forEach(p => {
    const html = marked.parseInline(p.innerHTML);
    p.innerHTML = html;
  });
  hljs.highlightAll();

  // Auto line highlight effect
  document.querySelectorAll("pre.code-block code").forEach(code => {
    const lines = code.innerHTML.split("\n").map(line => `<span class='code-line'>${line}</span>`).join("\n");
    code.innerHTML = lines;
  });
});

function copyCode(btn) {
  const codeElement = btn.closest('.code-wrapper').querySelector('pre code');
  const text = codeElement.innerText;
  navigator.clipboard.writeText(text).then(() => {
    const overlay = document.createElement("div");
    overlay.className = "copy-success";
    overlay.innerHTML = "✓ Copied successfully";
    btn.closest('.code-wrapper').appendChild(overlay);
    setTimeout(() => overlay.classList.add("show"), 50);
    setTimeout(() => overlay.classList.remove("show"), 1500);
    setTimeout(() => overlay.remove(), 2000);
  });
}
</script>

<style>
/* === Radical Neon Theme === */
.code-wrapper {
  position: relative;
  border: 1px solid #f472b6;
  border-radius: 0.75rem;
  background: #0b0f1c;
  overflow: hidden;
  margin: 2rem 0;
  box-shadow: 0 0 15px #f0f3;
  transition: all 0.3s ease;
}
.code-wrapper:hover {
  box-shadow: 0 0 25px #f0f6;
  border-color: #f472b6;
}
.code-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: .4rem .75rem;
  background: linear-gradient(to right, rgba(244,114,182,0.2), rgba(167,139,250,0.15), rgba(56,189,248,0.1));
  border-bottom: 1px solid #f472b6;
  backdrop-filter: blur(6px);
}
.code-header .dots {
  display: flex;
  gap: 5px;
}
.code-header .dot {
  width: 11px;
  height: 11px;
  border-radius: 50%;
  box-shadow: 0 0 5px currentColor;
}
.dot.red { color: #f87171; background: #f87171; }
.dot.yellow { color: #facc15; background: #facc15; }
.dot.green { color: #4ade80; background: #4ade80; }

.copy-btn {
  font-size: 0.75rem;
  padding: 0.25rem 0.6rem;
  border: 1px solid #f472b6aa;
  border-radius: 0.4rem;
  color: #e4e4e7;
  background: rgba(244,114,182,0.1);
  cursor: pointer;
  transition: all .2s;
}
.copy-btn:hover {
  background: rgba(244,114,182,0.25);
  box-shadow: 0 0 8px #f472b6aa;
  color: #ffffff;
}

/* Code block core */
pre.code-block {
  counter-reset: line;
  margin: 0;
  padding: 1rem 0 1rem 3.5rem;
  overflow-x: auto;
  font-size: 0.9rem;
  line-height: 1.6;
  background: rgba(12, 14, 24, 0.9);
  border: 1px solid rgba(255, 0, 255, 0.2);
  box-shadow: 0 0 12px 2px rgba(255, 0, 255, 0.4),
              0 0 24px 8px rgba(255, 0, 255, 0.15) inset;
  border-radius: 30px;
  position: relative;

}
pre.code-block code {
  counter-increment: line;
  display: block;
  white-space: pre;
  position: relative;
  font-family: "JetBrains Mono","Fira Code",monospace;
  color: white;
}
pre.code-block code::before {
  content: counter(line);
  position: absolute;
  left: -2.5rem;
  color: #6b7280;
  text-align: right;
  width: 2rem;
  user-select: none;
}

/* Syntax tone (light highlight, not flashy) */
pre.code-block .keyword { color: #569cd6; }
pre.code-block .type { color: #4ec9b0; }
pre.code-block .string { color: #ce9178; }
pre.code-block .number { color: #b5cea8; }
pre.code-block .comment { color: #6a9955; font-style: italic; 
}

/* Baris aktif glow */
.code-line {
  display: block;
  padding-right: 1rem;
  transition: background 0.2s ease;
}
.code-line:hover {
  background: linear-gradient(to right, rgba(244,114,182,0.1), transparent);
}

/* Syntax highlight */
.hljs-keyword, .hljs-selector-tag, .hljs-title { color: #f472b6; }
.hljs-string, .hljs-attr, .hljs-symbol { color: #38bdf8; }
.hljs-number, .hljs-literal { color: #a78bfa; }
.hljs-comment { color: #64748b; font-style: italic; }
.hljs-function .hljs-title { color: #f0abfc; }

/* Copy success overlay */
.copy-success {
  position: absolute;
  bottom: 10px;
  right: 10px;
  background: rgba(10, 200, 130, 0.15);
  color: #4ade80;
  border: 1px solid #4ade8080;
  padding: 5px 10px;
  border-radius: 6px;
  font-size: 0.8rem;
  opacity: 0;
  transform: translateY(10px);
  transition: all .3s ease;
  pointer-events: none;
  font-weight: 500;
  box-shadow: 0 0 8px #4ade80aa;
}
.copy-success.show {
  opacity: 1;
  transform: translateY(0);
}

/* Markdown */
#blog-content strong { color: #f472b6; font-weight: 600; }
#blog-content em { color: #a78bfa; font-style: italic; }
#blog-content code { background: #1e1e2e; color: #38bdf8; padding: 2px 5px; border-radius: 5px; font-family: "JetBrains Mono"; }
#blog-content a { color: #38bdf8; text-decoration: underline; transition: color .2s ease; }
#blog-content a:hover { color: #f472b6; }
</style>
{% endblock %}
